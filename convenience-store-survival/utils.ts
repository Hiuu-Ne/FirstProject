import { SelectedItem, NutritionSummary, SurvivalResult } from './types';
export function calculateNutrition(selectedItems: SelectedItem[]): NutritionSummary {
  let totalCalories=0,totalProtein=0,totalSodium=0,totalSugar=0,totalVitaminC=0,totalFiber=0,totalCaffeine=0,totalAlcohol=0;
  selectedItems.forEach(({item,quantity})=>{totalCalories+=item.calories*quantity;totalProtein+=item.protein*quantity;totalSodium+=item.sodium*quantity;totalSugar+=item.sugar*quantity;totalVitaminC+=item.vitaminC*quantity;totalFiber+=item.fiber*quantity;totalCaffeine+=(item.caffeine||0)*quantity;totalAlcohol+=(item.alcohol||0)*quantity});
  return{totalCalories,totalProtein,totalSodium,totalSugar,totalVitaminC,totalFiber,totalCaffeine,totalAlcohol};
}
export function calculateSurvival(selectedItems: SelectedItem[]): SurvivalResult {const nutrition=calculateNutrition(selectedItems);const baseDays=nutrition.totalCalories/2000;let nutritionScore=0;const proteinPerDay=nutrition.totalProtein/Math.max(baseDays,1);if(proteinPerDay>=50)nutritionScore+=20;else if(proteinPerDay>=30)nutritionScore+=15;else if(proteinPerDay>=20)nutritionScore+=10;else if(proteinPerDay>=10)nutritionScore+=5;const vitaminCPerDay=nutrition.totalVitaminC/Math.max(baseDays,1);if(vitaminCPerDay>=100)nutritionScore+=20;else if(vitaminCPerDay>=50)nutritionScore+=15;else if(vitaminCPerDay>=25)nutritionScore+=10;else if(vitaminCPerDay>=10)nutritionScore+=5;const fiberPerDay=nutrition.totalFiber/Math.max(baseDays,1);if(fiberPerDay>=25)nutritionScore+=10;else if(fiberPerDay>=15)nutritionScore+=7;else if(fiberPerDay>=10)nutritionScore+=5;else if(fiberPerDay>=5)nutritionScore+=3;const sugarPerDay=nutrition.totalSugar/Math.max(baseDays,1);if(sugarPerDay<=50)nutritionScore+=15;else if(sugarPerDay<=100)nutritionScore+=10;else if(sugarPerDay<=150)nutritionScore+=5;const sodiumPerDay=nutrition.totalSodium/Math.max(baseDays,1);if(sodiumPerDay<=2000)nutritionScore+=15;else if(sodiumPerDay<=4000)nutritionScore+=10;else if(sodiumPerDay<=6000)nutritionScore+=5;if(proteinPerDay>=40&&vitaminCPerDay>=80&&fiberPerDay>=20&&sugarPerDay<=60&&sodiumPerDay<=2500)nutritionScore+=20;else if(proteinPerDay>=30&&vitaminCPerDay>=50&&fiberPerDay>=15&&sugarPerDay<=80&&sodiumPerDay<=3500)nutritionScore+=10;nutritionScore=Math.min(nutritionScore,100);let nutritionBonus=0;if(nutritionScore>=90)nutritionBonus=0.5;else if(nutritionScore>=70)nutritionBonus=0.3;else if(nutritionScore>=50)nutritionBonus=0.1;else if(nutritionScore>=30)nutritionBonus=-0.1;else nutritionBonus=-0.3;let trapPenalty=0;let trapMessages: string[]=[];let hasInstantDeath=false;selectedItems.forEach(({item,quantity})=>{if(item.isTrap&&item.trapEffect&&quantity>0){if(item.trapEffect.type==='instant_death'){hasInstantDeath=true;trapMessages.push(item.trapEffect.message)}else{trapPenalty+=item.trapEffect.days*quantity;trapMessages.push(item.trapEffect.message)}}});if(hasInstantDeath){return{baseDays:0,nutritionScore:0,nutritionBonus:0,trapPenalty:0,finalDays:0,finalHours:0,deathReason:trapMessages.join('\n\n'),grade:'ğŸ’€ğŸ’€ğŸ’€',gradeEmoji:'ğŸ”¥',evaluation:'...í•  ë§ì´ ì—†ìŠµë‹ˆë‹¤.',specialTitle:'ì‚¬ê³ ë­‰ì¹˜',rank:100}}let finalDays=baseDays*(1+nutritionBonus)+trapPenalty;finalDays=Math.max(finalDays,0);const finalHours=Math.round(finalDays*24*10)/10;const deathReason='ìƒì¡´ ì¢…ë£Œ';const grade='A';const gradeEmoji='ğŸ†';const evaluation='ì˜í–ˆìŠµë‹ˆë‹¤';const specialTitle=undefined;const rank=15;return{baseDays,nutritionScore,nutritionBonus:nutritionBonus*100,trapPenalty,finalDays,finalHours,deathReason,grade,gradeEmoji,evaluation,specialTitle,rank}}
